module;
#include <cstdint>
#include <memory>
#include <filesystem>
#include <functional>
#include <vector>

#include <arrow/type_fwd.h>

export module libMNA.io.parquet_reader;

namespace mna {

namespace fs = std::filesystem;

export class ParquetReader{
private:
  using VertexCallback = std::function<void(int64_t R, int64_t B, int64_t busy, int64_t inactive)>;
  using EdgeCallback = std::function<void(int32_t source, int32_t target, int32_t latency)>;
  using JobCallback = std::function<void(int64_t jr, int64_t jb, int64_t jl, int64_t jo)>;

  arrow::Result<std::shared_ptr<arrow::Table>> read_file(fs::path file_path);

public:
  void read_vertexes(fs::path nodes_file, VertexCallback consume_vertex);
  void read_edges(std::vector<fs::path> edges_files, EdgeCallback consume_edge);
  void read_jobs(fs::path jobs_file, JobCallback consume_job);
};

} // namespace mna
